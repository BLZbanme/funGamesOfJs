<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>贪吃蛇</title>
    <style>
      .canvas {
        margin: 0 auto;
        display: flex;
        justify-content: center;
      }
    </style>
  </head>

  <body>
    <div class='canvas'>
      <canvas></canvas>
    </div>
    
    <script>
      const canvas = document.querySelector('canvas');
      const ctx = canvas.getContext('2d');
      const size = 20;
      const width = canvas.width = Math.floor(window.innerWidth * .6 / size) * size;
      const height = canvas.height = Math.floor(window.innerHeight * .6 / size) * size;
      drawBorder();

      function Snake(x, y, length, v, dir){
        this.body = getBodyArr(x, y, length, dir);
        this.v = v;
        this.dir = dir;
        this.alive = true;
      }

      function drawBorder(){
        ctx.beginPath();
        ctx.fillStyle = "black";
        ctx.strokeRect(0, 0, width, height);
      }

      function getBodyArr(x, y, length, dir){
        let body = [];
        for(let i = 0; i < length; i++){
          switch(dir){
            case "right":
              body.push([x - i * size, y]);
              break;
            case "left":
              body.push([x + i * size, y]);
              break;
            case "top":
              body.push([x, y + i * size]);
              break;
            case "down":
              body.push([x, y - i * size]);
              break;
            default:
              body.push([x - i * size, y]);
              break;
          }
        }
        return body;
      }

      Snake.prototype.draw = function(){
        ctx.beginPath();
        ctx.fillStyle = "red";
        for(let e of this.body){
          ctx.fillRect(e[0], e[1], size, size);
        }
      }

      Snake.prototype.move = function(){
        let body = this.body;
        let v = this.v;
        for(let i = body.length - 1; i > 0; i--){
          body[i][0] = body[i - 1][0];
          body[i][1] = body[i - 1][1];
        }
        switch(this.dir){
          case "right":
              body[0][0] += size * v;
              break;
            case "left":
              body[0][0] -= size * v;
              break;
            case "top":
              body[0][1] -= size * v;
              break;
            case "down":
              body[0][1] += size * v;
              break;
        }
        this.alive = !isDeadSnake(body);
      }

      function isDeadSnake(body){
        return body[0][0] < 0 || body[0][0] > width || body[0][1] < 0 || body[0][1] > height;
      }

      var snake = new Snake(Math.floor(width / 2), Math.floor(height / 2), 3, 1, "right");
      snake.draw();

      function loop(){
        if(!snake.alive){
          alert("you dead");
          return;
        }
        ctx.clearRect(0, 0, width, height);
        drawBorder();
        snake.draw();
        snake.move();
        requestAnimationFrame(loop);
      };

      loop();

       window.onkeydown = function(e){
         switch(e.key){
          case "ArrowLeft":
            snake.dir = "left"
            break;
          case "ArrowRight":
            snake.dir = "right"
            break;
          case "ArrowUp":
            snake.dir = "top"
            break;
          case "ArrowDown":
            snake.dir = "down"
            break;
         }
       }

      

      
    </script>
  </body>
</html>